# =============================================================================
# ARTIQ Configuration File
# Phase 3C: External configuration for all ARTIQ experiments
# =============================================================================
# 
# This file contains all configurable parameters for the ARTIQ control system.
# Change values here instead of modifying code.
#
# Environment-specific overrides can be placed in:
#   - artiq_config_local.yaml (not tracked by git)
#   - artiq_config_development.yaml
#   - artiq_config_production.yaml
#
# Usage in Python:
#   from utils.config_loader import get_artiq_config
#   config = get_artiq_config()
#   ip = config['network']['master_ip']
# =============================================================================

---
# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================
network:
  # ARTIQ master IP address (the machine running artiq_master)
  # Default: 192.168.56.101 (VirtualBox host-only network)
  master_ip: "192.168.56.101"
  
  # ZMQ Ports
  cmd_port: 5555        # Commands: Manager → ARTIQ (PUB/SUB)
  data_port: 5556       # Data: ARTIQ → Manager (PUSH/PULL)
  client_port: 5557     # Client requests: Flask → Manager (REQ/REP)
  camera_port: 5558     # Camera server TCP port
  
  # Timeouts (seconds)
  connection_timeout: 5.0
  receive_timeout: 1.0
  watchdog_timeout: 30.0
  
  # Retry settings
  max_retries: 3
  retry_base_delay: 1.0


# =============================================================================
# FRAGMENT CONFIGURATION
# =============================================================================
fragments:
  # DDS (Urukul) Settings
  dds:
    # Device names from device_db.py
    devices:
      axial: "urukul0_ch0"
      radial: "urukul0_ch1"
      raman_0: "urukul0_ch2"
      raman_1: "urukul0_ch3"
    
    # Default parameters
    defaults:
      att_db: 25.0        # Default attenuation
      amp_min: 0.05       # Minimum amplitude (safety)
      amp_max: 1.0        # Maximum amplitude
  
  # PMT Counter Settings
  pmt:
    device: "ttl0_counter"
    defaults:
      duration_ms: 100.0
      min_duration_ms: 1.0
      max_duration_ms: 10000.0
  
  # Camera Trigger Settings
  camera:
    device: "ttl4"
    defaults:
      pulse_ms: 10.0
      short_pulse_us: 10.0
  
  # DC Electrode Settings
  dc:
    # Zotino channels
    ec_channels: [4, 5]           # Endcap channels
    comp_channels: [0, 1, 2, 3]   # Compensation channels
    
    # Voltage limits (safety)
    limits:
      ec_min: -1.0
      ec_max: 50.0
      comp_min: -10.0
      comp_max: 10.0
    
    # Defaults
    defaults:
      ec1: 0.0
      ec2: 0.0
      comp_h: 0.0
      comp_v: 0.0


# =============================================================================
# EXPERIMENT DEFAULTS
# =============================================================================
experiments:
  # DC Setting Experiment
  set_dc:
    settling_time_ms: 100
  
  # Secular Sweep Experiment
  secular_sweep:
    defaults:
      target_freq_khz: 400.0
      span_khz: 40.0
      steps: 41
      att_db: 25.0
      on_time_ms: 100.0
      off_time_ms: 100.0
      dds_choice: "axial"
    
    # Safety limits
    limits:
      min_freq_khz: 100.0
      max_freq_khz: 1000.0
      max_steps: 1000
      max_on_time_ms: 1000.0
  
  # PMT Measurement Experiment
  pmt_measure:
    defaults:
      duration_ms: 100.0
      num_samples: 1
    limits:
      max_duration_ms: 10000.0
      max_samples: 1000


# =============================================================================
# SAFETY CONFIGURATION
# =============================================================================
safety:
  # Emergency shutdown settings
  emergency:
    # Maximum time before automatic safety shutdown (seconds)
    auto_shutdown_seconds: 30.0
    
    # Safe state values
    safe_state:
      ec_volts: 0.0
      comp_volts: 0.0
      raman_amp: 0.05
      dds_switch: false
  
  # Voltage limits
  voltage_limits:
    max_rf: 250.0       # Maximum RF voltage (V)
    max_piezo: 4.0      # Maximum piezo voltage (V)
    max_dc: 50.0        # Maximum DC voltage (V)
    min_dc: -1.0        # Minimum DC voltage (V)
  
  # Pressure monitoring
  pressure:
    normal_max: 5.0e-9      # Normal operation (mbar)
    warning: 1.0e-8         # Warning level (mbar)
    critical: 1.0e-7        # Critical level (mbar)
    emergency: 1.0e-6       # Emergency shutdown (mbar)


# =============================================================================
# HARDWARE CONFIGURATION
# =============================================================================
hardware:
  # RF System
  rf:
    frequency_mhz: 20.0
    voltage_scale_factor: 0.142857  # mV to V conversion
  
  # Laser System
  lasers:
    raman:
      freq0_mhz: 215.5
      freq1_mhz: 215.5
      wavelength_nm: 313.0
    
    cooling:
      wavelength_nm: 313.0
  
  # Camera
  camera:
    model: "Hamamatsu Orca"
    resolution: [2048, 2048]
    pixel_size_um: 6.5
    cooling_c: -20.0


# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s [%(name)s] %(levelname)s: %(message)s"
  
  files:
    worker: "./logs/artiq_worker.log"
    experiments: "./logs/experiments.log"
  
  # Log rotation
  rotation:
    max_bytes: 1048576  # 1 MB
    backup_count: 5


# =============================================================================
# PERFORMANCE SETTINGS
# =============================================================================
performance:
  # Sweep optimization
  sweep:
    # Pre-allocate result buffers for max performance
    max_buffer_size: 1000
    
    # Use parallel execution where possible
    use_parallel: true
  
  # Kernel optimization
  kernel:
    # Break realtime at start of kernels
    break_realtime: true
    
    # Default delays
    default_delay_us: 100


# =============================================================================
# ENVIRONMENT OVERRIDES (do not edit - use separate files)
# =============================================================================
# The following files are loaded in order (later overrides earlier):
#   1. artiq_config.yaml (this file)
#   2. artiq_config_{environment}.yaml (development/production)
#   3. artiq_config_local.yaml (local machine, not in git)
#
# To override for your machine, create artiq_config_local.yaml:
#   network:
#     master_ip: "127.0.0.1"
